# ‚úÖ Research –ó–∞–≤–µ—Ä—à–µ–Ω: TLDraw –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ & –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –ë–î

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è

### –°–æ–∑–¥–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã:
1. **TLDRAW_POSITION_FINDINGS.md** - –ü–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç —Å findings –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏
2. **DATABASE_SCHEMA.sql** - –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ –ë–î —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏
3. **TestPositionSync.jsx** - –¢–µ—Å—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–æ–∑–∏—Ü–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
4. **TestDateLayout.jsx** - –¢–µ—Å—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ –¥–∞—Ç–∞–º

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã

### 1. –¢–µ—Å—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ–∑–∏—Ü–∏–π
```bash
cd frontend
npm run dev
# –û—Ç–∫—Ä—ã—Ç—å http://localhost:5173/?test=position
```

**–ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç:**
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ–∑–∏—Ü–∏–π shapes –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- Batch –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–∞ shapes
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
- Store listeners –∏ subscriptions

### 2. –¢–µ—Å—Ç –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ –¥–∞—Ç–∞–º
```bash
cd frontend
npm run dev
# –û—Ç–∫—Ä—ã—Ç—å http://localhost:5173/?test=date
```

**–ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ –∑–∞–º–µ—Ç–æ–∫ –ø–æ –¥–∞—Ç–∞–º (–∫–æ–ª–æ–Ω–∫–∏)
- Collision avoidance (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –Ω–∞–ª–æ–∂–µ–Ω–∏–π)
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–º–µ—Ç–æ–∫
- –°–∏–º—É–ª—è—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ –ë–î

### 3. Production –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
```bash
cd frontend
npm run dev
# –û—Ç–∫—Ä—ã—Ç—å http://localhost:5173/ (–±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤)
```

## üéØ –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã

### –ß—Ç–æ –º—ã —É–∑–Ω–∞–ª–∏ –æ tldraw:
1. **–ü–æ–∑–∏—Ü–∏–∏** - x,y —Ö—Ä–∞–Ω—è—Ç—Å—è –∫–∞–∫ top-level —Å–≤–æ–π—Å—Ç–≤–∞ shapes (–Ω–µ –≤ props)
2. **–°–æ–±—ã—Ç–∏—è** - `editor.store.listen()` –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏—è** - `editor.updateShapes()` –¥–ª—è batch –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
4. **Store** - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç atomic operations –∏ reactive atoms

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ–¥—Ö–æ–¥:

#### –î–ª—è MVP:
```javascript
// –ë–î: –•—Ä–∞–Ω–∏—Ç—å –º–∏–Ω–∏–º—É–º
{
  date: '2024-08-07',     // –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–æ–ª–æ–Ω–∫—É
  time: '10:30',          // –î–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
  order_in_column: 1      // –†—É—á–Ω–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
}

// Frontend: –í—ã—á–∏—Å–ª—è—Ç—å –ø–æ–∑–∏—Ü–∏–∏
const x = calculateColumnX(note.date)
const y = calculateRowY(note.time, note.order_in_column)
```

#### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:
- **One-way**: –ë–î ‚Üí tldraw (–ø—Ä–æ—â–µ, –Ω–∞–¥–µ–∂–Ω–µ–µ)
- **Polling**: –ö–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
- **Future**: WebSocket –¥–ª—è real-time

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### Backend (–°—Ä–æ—á–Ω–æ):
1. [ ] –°–æ–∑–¥–∞—Ç—å PostgreSQL –ë–î –∏—Å–ø–æ–ª—å–∑—É—è `DATABASE_SCHEMA.sql`
2. [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å API endpoints:
   - `GET /api/notes` - –ø–æ–ª—É—á–∏—Ç—å –∑–∞–º–µ—Ç–∫–∏ —Å –¥–∞—Ç–∞–º–∏
   - `POST /api/notes` - —Å–æ–∑–¥–∞—Ç—å –∑–∞–º–µ—Ç–∫—É –æ—Ç –±–æ—Ç–∞
   - `PATCH /api/notes/:id` - –æ–±–Ω–æ–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É
3. [ ] –ü–æ–¥–∫–ª—é—á–∏—Ç—å Telegram bot –∫ –ë–î

### Frontend (–ü–æ—Å–ª–µ Backend):
1. [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å `DateLayoutManager` –≤ `ProductionApp.jsx`
2. [ ] –î–æ–±–∞–≤–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –∏–∑ API –ø—Ä–∏ mount
3. [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
4. [ ] –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç–∞—Ç—É—Å–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
1. [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å 100+ –∑–∞–º–µ—Ç–∫–∞–º–∏
2. [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
3. [ ] –¢–µ—Å—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –ø–æ–∑–∏—Ü–∏–π

## üîß –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### 1. –î–æ–±–∞–≤–∏—Ç—å –≤ ProductionApp.jsx:
```javascript
import { DateLayoutManager } from './utils/DateLayoutManager'

// –í handleMount:
useEffect(() => {
  const loadNotes = async () => {
    const notes = await fetch('/api/notes').then(r => r.json())
    const layoutManager = new DateLayoutManager()
    
    notes.forEach(note => {
      const pos = layoutManager.calculatePosition(note, baseDate)
      editor.createShape({
        type: 'custom-note',
        x: pos.x,
        y: pos.y,
        props: { ...note, dbId: note.id }
      })
    })
  }
  
  loadNotes()
  const interval = setInterval(loadNotes, 30000)
  return () => clearInterval(interval)
}, [editor])
```

### 2. Backend endpoint –ø—Ä–∏–º–µ—Ä:
```javascript
app.get('/api/notes', async (req, res) => {
  const notes = await db.query(`
    SELECT * FROM get_notes_with_positions($1)
  `, [req.user.id])
  
  res.json(notes)
})
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ** React StrictMode —Å tldraw (–±–∞–≥ #5611)
2. **–í—Å–µ–≥–¥–∞** –≤—ã—á–∏—Å–ª—è–π—Ç–µ –ø–æ–∑–∏—Ü–∏–∏ –Ω–∞ frontend –¥–ª—è –≥–∏–±–∫–æ—Å—Ç–∏
3. **Debounce** —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π –µ—Å–ª–∏ –¥–æ–±–∞–≤–∏—Ç–µ two-way sync
4. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ** batch updates –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [TLDraw Docs](https://tldraw.dev)
- [Store API](https://tldraw.dev/docs/editor#store)
- [Shape Utils](https://tldraw.dev/docs/shapes)

## ‚ú® –ì–æ—Ç–æ–≤–æ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏!

Research –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ. –í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–Ω–∞–Ω–∏—è –ø–æ–ª—É—á–µ–Ω—ã, —Ç–µ—Å—Ç—ã —Å–æ–∑–¥–∞–Ω—ã, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞–ø–∏—Å–∞–Ω—ã. –ú–æ–∂–Ω–æ –ø—Ä–∏—Å—Ç—É–ø–∞—Ç—å –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ backend API –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å frontend.