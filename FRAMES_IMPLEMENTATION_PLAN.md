# üìã –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã —Ñ—Ä–µ–π–º–æ–≤

## üèóÔ∏è –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

### –ß—Ç–æ —Ç–∞–∫–æ–µ —Ñ—Ä–µ–π–º –≤ –Ω–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ
- **–§—Ä–µ–π–º** - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –∑–∞–º–µ—Ç–æ–∫ —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ –∏ —Ä–∞–∑–º–µ—Ä–∞–º–∏
- **–ó–∞–º–µ—Ç–∫–∞ –≤–æ —Ñ—Ä–µ–π–º–µ** - –∑–∞–º–µ—Ç–∫–∞ —Å `frameId` –∏ `parentId` —É–∫–∞–∑—ã–≤–∞—é—â–∏–º–∏ –Ω–∞ —Ñ—Ä–µ–π–º
- **–°–≤–æ–±–æ–¥–Ω–∞—è –∑–∞–º–µ—Ç–∫–∞** - –∑–∞–º–µ—Ç–∫–∞ –±–µ–∑ `frameId`, `parentId = pageId`

### –°–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–º–µ—Ç–æ–∫
1. **–í –∫–æ–ª–æ–Ω–∫–µ –¥–∞—Ç—ã** - `manuallyPositioned: false`, `frameId: null`, x –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
2. **–°–≤–æ–±–æ–¥–Ω–∞—è –Ω–∞ —Ö–æ–ª—Å—Ç–µ** - `manuallyPositioned: true`, `frameId: null`, —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ x/y –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
3. **–í–Ω—É—Ç—Ä–∏ —Ñ—Ä–µ–π–º–∞** - `frameId: frameId`, `parentId: frameId`, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ö–æ–ª—Å—Ç–∞ (–Ω–µ —Ñ—Ä–µ–π–º–∞!)

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (PostgreSQL)
**–¢–∞–±–ª–∏—Ü–∞ Frame:**
- `id` - UUID —Ñ—Ä–µ–π–º–∞ (—Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å tldraw shapeId)
- `name` - –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ—Ä–µ–π–º–∞
- `x, y` - –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–∞ —Ö–æ–ª—Å—Ç–µ
- `width, height` - —Ä–∞–∑–º–µ—Ä—ã —Ñ—Ä–µ–π–º–∞

**–¢–∞–±–ª–∏—Ü–∞ Note:**
- `frameId` - ID —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —Ñ—Ä–µ–π–º–∞ (nullable)
- `x, y` - –ê–ë–°–û–õ–Æ–¢–ù–´–ï –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–∞ —Ö–æ–ª—Å—Ç–µ (–ù–ï –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ!)
- `manuallyPositioned` - —Ñ–ª–∞–≥ —Ä—É—á–Ω–æ–≥–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è

### –í tldraw (frontend)
**Frame shape:**
- `type: 'frame'`
- `props.name` - –Ω–∞–∑–≤–∞–Ω–∏–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç –¥–æ—á–µ—Ä–Ω–∏–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏

**CustomNote shape:**
- `parentId` - ID —Ñ—Ä–µ–π–º–∞ –∏–ª–∏ pageId
- `props.dbId` - ID –∑–∞–º–µ—Ç–∫–∏ –≤ –ë–î –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

---

## üîÑ –û–ø–µ—Ä–∞—Ü–∏–∏ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

### 1. –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
**–§—É–Ω–∫—Ü–∏—è:** `handleMount` ‚Üí `loadNotes`

**–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
1. `GET /api/notes` - –∑–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ –∑–∞–º–µ—Ç–∫–∏
2. `GET /frames` - –∑–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ —Ñ—Ä–µ–π–º—ã
3. –°–æ–∑–¥–∞–µ–º frame shapes –Ω–∞ —Ö–æ–ª—Å—Ç–µ
4. –°–æ–∑–¥–∞–µ–º note shapes —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ parentId

**–í–∞–∂–Ω–æ:** –ó–∞–º–µ—Ç–∫–∏ —Å `frameId` –ø–æ–ª—É—á–∞—é—Ç `parentId: frameId` –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ shape

---

### 2. –°–æ–∑–¥–∞–Ω–∏–µ —Ñ—Ä–µ–π–º–∞ –∏–∑ –≤—ã–¥–µ–ª–µ–Ω–∏—è
**–§—É–Ω–∫—Ü–∏—è:** `handleCreateFrame`

**–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
1. –í—ã—á–∏—Å–ª—è–µ–º bounds –≤—ã–¥–µ–ª–µ–Ω–Ω—ã—Ö –∑–∞–º–µ—Ç–æ–∫
2. –°–æ–∑–¥–∞–µ–º frame shape –≤ tldraw
3. `editor.reparentShapes` - –ø–µ—Ä–µ–º–µ—â–∞–µ–º –∑–∞–º–µ—Ç–∫–∏ –≤ —Ñ—Ä–µ–π–º (–º–µ–Ω—è–µ—Ç—Å—è parentId)
4. `POST /frames` —Å –¥–∞–Ω–Ω—ã–º–∏:
   - `id` - —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å tldraw shapeId
   - `noteIds` - –º–∞—Å—Å–∏–≤ dbId –∑–∞–º–µ—Ç–æ–∫ –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏
   - `x, y, width, height` - –≥–µ–æ–º–µ—Ç—Ä–∏—è —Ñ—Ä–µ–π–º–∞

**–ù–∞ backend:** 
- –°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å Frame
- –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è `frameId` —É –≤—Å–µ—Ö –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã—Ö –∑–∞–º–µ—Ç–æ–∫

---

### 3. –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ –≤/–∏–∑ —Ñ—Ä–µ–π–º–∞
**–°–ª—É—à–∞—Ç–µ–ª—å:** `unsubscribeFrames` –≤ `handleMount`

**–¢—Ä–∏–≥–≥–µ—Ä:** –ò–∑–º–µ–Ω–µ–Ω–∏–µ `parentId` —É shape

**–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
1. tldraw –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–µ–Ω—è–µ—Ç parentId –ø—Ä–∏ drag&drop
2. –°–ª—É—à–∞—Ç–µ–ª—å –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–π –∏ –Ω–æ–≤—ã–π parent
3. `PATCH /api/notes/{dbId}` —Å –¥–∞–Ω–Ω—ã–º–∏:
   - `frameId` - –Ω–æ–≤—ã–π frameId –∏–ª–∏ null

**–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:** –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è! –ü–æ–∑–∏—Ü–∏—è –æ–±–Ω–æ–≤–∏—Ç—Å—è –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–∏

---

### 4. –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Ñ—Ä–µ–π–º–∞
**–¢–µ–∫—É—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:** –í–†–ï–ú–ï–ù–ù–û –û–¢–ö–õ–Æ–ß–ï–ù–û –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π

**–ö–∞–∫ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å:**
1. –ü—Ä–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–∏ —Ñ—Ä–µ–π–º–∞ tldraw –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–≤–∏–≥–∞–µ—Ç –≤—Å–µ –¥–æ—á–µ—Ä–Ω–∏–µ shapes
2. –î–ª—è —Ñ—Ä–µ–π–º–∞: `PATCH /frames/{id}` —Å –Ω–æ–≤—ã–º–∏ `x, y`
3. –î–ª—è –∫–∞–∂–¥–æ–π –∑–∞–º–µ—Ç–∫–∏ –≤–Ω—É—Ç—Ä–∏: `PATCH /api/notes/{id}/position` —Å –Ω–æ–≤—ã–º–∏ –∞–±—Å–æ–ª—é—Ç–Ω—ã–º–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–µ–π—á–∞—Å –æ—Ç–∫–ª—é—á–µ–Ω–æ —á–µ—Ä–µ–∑ `sendPositionUpdate` –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

---

### 5. –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ –≤–Ω—É—Ç—Ä–∏ —Ñ—Ä–µ–π–º–∞
**–¢–µ–∫—É—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:** –í–†–ï–ú–ï–ù–ù–û –û–¢–ö–õ–Æ–ß–ï–ù–û

**–ö–∞–∫ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å:**
1. –ó–∞–º–µ—Ç–∫–∞ –¥–≤–∏–≥–∞–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –≥—Ä–∞–Ω–∏—Ü —Ñ—Ä–µ–π–º–∞
2. `PATCH /api/notes/{id}/position` —Å –Ω–æ–≤—ã–º–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏
3. –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ—Å—Ç–∞—é—Ç—Å—è –∞–±—Å–æ–ª—é—Ç–Ω—ã–º–∏ (–Ω–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–º–∏!)

---

### 6. –£–¥–∞–ª–µ–Ω–∏–µ —Ñ—Ä–µ–π–º–∞
**Endpoint:** `DELETE /frames/{id}`

**–ü–æ–≤–µ–¥–µ–Ω–∏–µ:**
- –í –ë–î: `onDelete: SetNull` - –∑–∞–º–µ—Ç–∫–∏ —Ç–µ—Ä—è—é—Ç frameId
- –í tldraw: –∑–∞–º–µ—Ç–∫–∏ –æ—Å—Ç–∞—é—Ç—Å—è –Ω–∞ —Ö–æ–ª—Å—Ç–µ –≤ —Ç–µ—Ö –∂–µ –ø–æ–∑–∏—Ü–∏—è—Ö
- parentId –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è pageId

---

### 7. –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ñ—Ä–µ–π–º–∞
**–í—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ tldraw:**
- –ü—Ä–∏ —É–º–µ–Ω—å—à–µ–Ω–∏–∏: –∫–æ–Ω—Ç–µ–Ω—Ç –æ–±—Ä–µ–∑–∞–µ—Ç—Å—è (clip content)
- –ü—Ä–∏ —É–≤–µ–ª–∏—á–µ–Ω–∏–∏: –∫–æ–Ω—Ç–µ–Ω—Ç —Å–Ω–æ–≤–∞ –≤–∏–¥–µ–Ω
- –ó–∞–º–µ—Ç–∫–∏ –ù–ï –≤—ã—Ç–∞–ª–∫–∏–≤–∞—é—Ç—Å—è, –ù–ï –ø–µ—Ä–µ–º–µ—â–∞—é—Ç—Å—è

**–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:**
- `PATCH /frames/{id}` —Å –Ω–æ–≤—ã–º–∏ `width, height`

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤—Å–µ–≥–¥–∞ –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ
- –í –ë–î —Ö—Ä–∞–Ω—è—Ç—Å—è –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–∞ —Ö–æ–ª—Å—Ç–µ
- tldraw —Å–∞–º —É–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–º –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º —á–µ—Ä–µ–∑ parentId
- –ü—Ä–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–∏ —Ñ—Ä–µ–π–º–∞ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤—Å–µ—Ö –∑–∞–º–µ—Ç–æ–∫

### Parent-child —Å–≤—è–∑—å
- `frameId` (–ë–î) ‚Üî `parentId` (tldraw)
- –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ: –µ—Å–ª–∏ –µ—Å—Ç—å frameId ‚Üí —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º parentId
- –ü—Ä–∏ drag&drop: –∏–∑–º–µ–Ω–µ–Ω–∏–µ parentId ‚Üí –æ–±–Ω–æ–≤–ª—è–µ–º frameId

### –í—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- `sendPositionUpdate` –æ—Ç–∫–ª—é—á–µ–Ω –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –†–∏—Å–æ–≤–∞–Ω–∏–µ —Ñ—Ä–µ–π–º–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–º –ù–ï —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ë–î (—Ç–æ–ª—å–∫–æ UI —Å–æ–∑–¥–∞–Ω–∏–µ)

---

## üîç Debug —Ñ—É–Ω–∫—Ü–∏–∏

### window.debugFrames()
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
- –í—Å–µ —Ñ—Ä–µ–π–º—ã –∏ –∏—Ö —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
- –°–≤—è–∑–∏ parent-child
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–º–µ—Ç–æ–∫ –≤ –∫–∞–∂–¥–æ–º —Ñ—Ä–µ–π–º–µ

### –õ–æ–≥–∏ –ø—Ä–∏ –æ–ø–µ—Ä–∞—Ü–∏—è—Ö
- `üîÑ === –ó–∞–º–µ—Ç–∫–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∞ ===` - –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ parentId
- `‚úÖ –§—Ä–µ–π–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –ë–î` - –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ñ—Ä–µ–π–º–∞
- `‚ö†Ô∏è –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π –æ—Ç–∫–ª—é—á–µ–Ω–æ` - –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

---

## üìù TODO: –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å

1. **–í–∫–ª—é—á–∏—Ç—å –æ–±—Ä–∞—Ç–Ω–æ sendPositionUpdate** –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
2. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ—Ä–µ–π–º–æ–≤ –ø—Ä–∏ —Ä–∏—Å–æ–≤–∞–Ω–∏–∏** - —Å–µ–π—á–∞—Å —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ UI –∫–Ω–æ–ø–∫—É
3. **Batch –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π** - –ø—Ä–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–∏ —Ñ—Ä–µ–π–º–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å
4. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤** - debounce –¥–ª—è —á–∞—Å—Ç—ã—Ö –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–π