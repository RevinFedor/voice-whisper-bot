# üîß –§–ò–ö–° –ü–†–û–ë–õ–ï–ú–´ –° –ö–£–†–°–û–†–û–ú –ü–†–ò –ü–ï–†–í–û–ú –ö–õ–ò–ö–ï

## üêõ –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∫–ª–∏–∫–µ –Ω–∞ textarea –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:
1. –ü–æ–∑–∏—Ü–∏—è –∫—É—Ä—Å–æ—Ä–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ `0`
2. –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ Enter –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä—ã–∂–æ–∫ —Å–∫—Ä–æ–ª–ª–∞ –Ω–∞–≤–µ—Ä—Ö
3. –¢–µ–∫—Å—Ç –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è –∫ –Ω–∞—á–∞–ª—É –¥–æ–∫—É–º–µ–Ω—Ç–∞, –¥–∞–∂–µ –µ—Å–ª–∏ –∫–ª–∏–∫ –±—ã–ª –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ

**–õ–æ–≥–∏ –ø—Ä–æ–±–ª–µ–º—ã:**
```
üîÑ –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é: {cursor: 0, scrollTop: 300}
// –ö—É—Ä—Å–æ—Ä –Ω–∞ 0, —Ö–æ—Ç—è —Ä–µ–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è –∫–ª–∏–∫–∞ –±—ã–ª–∞ 898
```

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:

1. **–î–æ–±–∞–≤–ª–µ–Ω —Ñ–ª–∞–≥ `isFirstInteraction`** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –ø–µ—Ä–≤–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ
2. **`requestAnimationFrame` –≤ `onClick`** - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–∞–π–º–∏–Ω–≥ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏
3. **–£—Å–ª–æ–≤–Ω—ã–π `useLayoutEffect`** - –Ω–µ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∫–ª–∏–∫–µ
4. **`setTimeout` –≤ `onFocus`** - —Ñ–∏–∫—Å –¥–ª—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ —Ñ–æ–∫—É—Å–∞

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥:

```jsx
const ControlledTextarea = ({ value, onChange }) => {
  const textAreaRef = useRef(null);
  const [cursor, setCursor] = useState(0);
  const [scrollTop, setScrollTop] = useState(0);
  const [isFirstInteraction, setIsFirstInteraction] = useState(true);

  // –ù–ï –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏
  useLayoutEffect(() => {
    const textArea = textAreaRef.current;
    if (textArea && !isFirstInteraction) {
      textArea.setSelectionRange(cursor, cursor);
      textArea.scrollTop = scrollTop;
    }
  }, [value, cursor, scrollTop, isFirstInteraction]);

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä–≤–æ–≥–æ –∫–ª–∏–∫–∞ —Å requestAnimationFrame
  const handleClick = useCallback((e) => {
    if (isFirstInteraction) {
      requestAnimationFrame(() => {
        const realPosition = e.target.selectionStart;
        if (realPosition >= 0) {
          e.target.setSelectionRange(realPosition, realPosition);
          setCursor(realPosition);
          setScrollTop(e.target.scrollTop);
        }
      });
      setIsFirstInteraction(false);
    } else {
      setCursor(e.target.selectionStart);
      setScrollTop(e.target.scrollTop);
    }
  }, [isFirstInteraction]);

  // –§–∏–∫—Å –¥–ª—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ —Ñ–æ–∫—É—Å–∞
  const handleFocus = useCallback((e) => {
    if (isFirstInteraction) {
      setTimeout(() => {
        const currentPos = e.target.selectionStart;
        setCursor(currentPos);
        setScrollTop(e.target.scrollTop);
        setIsFirstInteraction(false);
      }, 0);
    }
  }, [isFirstInteraction]);

  // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
};
```

## üéØ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:

- ‚úÖ **–ö—É—Ä—Å–æ—Ä –Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ 0** –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∫–ª–∏–∫–µ
- ‚úÖ **Enter —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ** –≤ –ª—é–±–æ–π –ø–æ–∑–∏—Ü–∏–∏
- ‚úÖ **–°–∫—Ä–æ–ª–ª –Ω–µ –ø—Ä—ã–≥–∞–µ—Ç** –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏
- ‚úÖ **–ü–æ–∑–∏—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è** –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
- ‚úÖ **–ü—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π —Ñ–æ–∫—É—Å** –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

## üìä –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–µ—Ä–≤—ã–π –∫–ª–∏–∫ –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ —Ç–µ–∫—Å—Ç–∞
1. –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å 5000+ —Å–∏–º–≤–æ–ª–∞–º–∏
2. –ü—Ä–æ—Å–∫—Ä–æ–ª–ª–∏—Ç—å –¥–æ —Å–µ—Ä–µ–¥–∏–Ω—ã
3. –ö–ª–∏–∫–Ω—É—Ç—å –≤ —Å–µ—Ä–µ–¥–∏–Ω—É —Ç–µ–∫—Å—Ç–∞
4. –ù–∞–∂–∞—Ç—å Enter
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ö—É—Ä—Å–æ—Ä –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–∞ –º–µ—Å—Ç–µ, —Å–∫—Ä–æ–ª–ª –Ω–µ –ø—Ä—ã–≥–∞–µ—Ç

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ö–ª–∏–∫ –ø–æ—Å–ª–µ –ø–æ—Ç–µ—Ä–∏ —Ñ–æ–∫—É—Å–∞
1. –ö–ª–∏–∫–Ω—É—Ç—å –≤ textarea
2. –ö–ª–∏–∫–Ω—É—Ç—å –≤–Ω–µ textarea
3. –ö–ª–∏–∫–Ω—É—Ç—å –æ–±—Ä–∞—Ç–Ω–æ –≤ —Å–µ—Ä–µ–¥–∏–Ω—É —Ç–µ–∫—Å—Ç–∞
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ü–æ–∑–∏—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ü—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π —Ñ–æ–∫—É—Å
1. –í—ã–∑–≤–∞—Ç—å `textAreaRef.current.focus()` –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –§–æ–∫—É—Å —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –±–µ–∑ —Å–±—Ä–æ—Å–∞ –ø–æ–∑–∏—Ü–∏–∏

## üîç –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ü–æ—á–µ–º—É `requestAnimationFrame`?

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∫–ª–∏–∫–µ –±—Ä–∞—É–∑–µ—Ä –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–∏–ª —Ä–µ–∞–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é `selectionStart`. 
`requestAnimationFrame` –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –º—ã –ø–æ–ª—É—á–∏–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è DOM.

### –ü–æ—á–µ–º—É —É—Å–ª–æ–≤–Ω—ã–π `useLayoutEffect`?

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏ –º—ã –Ω–µ —Ö–æ—Ç–∏–º –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –ø–æ–∑–∏—Ü–∏—é 0.
–î–∞–µ–º –±—Ä–∞—É–∑–µ—Ä—É —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—É—é –ø–æ–∑–∏—Ü–∏—é –∫–ª–∏–∫–∞.

### –ë—Ä–∞—É–∑–µ—Ä–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

- ‚úÖ Chrome 76+
- ‚úÖ Firefox 66+
- ‚úÖ Safari 14+
- ‚úÖ Edge 79+

## üí° –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

–î–ª—è –µ—â–µ –±–æ–ª—å—à–µ–π –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:

```jsx
// –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è Enter
const handleKeyDown = (e) => {
  if (e.key === 'Enter' && isFirstInteraction) {
    e.preventDefault();
    setIsFirstInteraction(false);
    setTimeout(() => {
      const pos = e.target.selectionStart;
      setCursor(pos);
      setScrollTop(e.target.scrollTop);
      // –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É
      const newValue = value.slice(0, pos) + '\n' + value.slice(pos);
      onChange(newValue);
    }, 0);
  }
};
```

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –≤ —Ç–µ—Å—Ç–æ–≤–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:
**http://localhost:5177/**

–í—ã–±–µ—Ä–∏—Ç–µ "Controlled Textarea —Å —Ñ–∏–∫—Å–æ–º —Å–∫—Ä–æ–ª–ª–∞" –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏.